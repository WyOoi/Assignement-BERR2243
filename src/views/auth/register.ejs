<div class="container py-5">
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="card custom-form shadow-lg border-0" data-aos="fade-up">
        <div class="card-body p-4 p-md-5">
        <div class="text-center mb-4">
            <div class="app-icon mb-3">
              <i class="fas fa-taxi"></i>
            </div>
            <h2 class="fw-bold">Create Account</h2>
            <p class="text-muted">Join MyTaxi and start your journey</p>
        </div>
        
        <% if (error) { %>
            <div class="alert custom-alert alert-danger alert-dismissible fade show animate__animated animate__fadeIn">
              <div class="alert-icon">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="alert-content">
            <%= error %>
              </div>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% } %>
        
          <!-- Registration Progress -->
          <div class="registration-progress mb-4">
            <div class="progress" style="height: 5px;">
              <div class="progress-bar" role="progressbar" style="width: 33%;" id="registrationProgressBar"></div>
            </div>
            <div class="d-flex justify-content-between mt-2">
              <span class="step active" id="step1">Account</span>
              <span class="step" id="step2">Details</span>
              <span class="step" id="step3">Confirmation</span>
            </div>
          </div>
          
          <form action="/auth/register" method="POST" id="registerForm" class="register-form">
            <!-- Step 1: Account Information -->
            <div class="registration-step" id="registrationStep1">
              <div class="mb-4">
                <h5 class="mb-3 fw-bold text-center">Choose your account type</h5>
                <div class="role-selection-container">
                  <div class="row g-3 mb-4">
                    <div class="col-12">
                      <div class="input-group input-group-lg">
                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-user-tag text-primary"></i></span>
                        <select class="form-select border-start-0" id="roleSelect" name="role">
                          <option value="passenger" selected>Passenger - Request rides around campus</option>
                          <option value="driver">Driver - Offer rides and earn money</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <h5 class="mb-3 fw-bold">Personal Information</h5>
          <div class="row mb-3">
            <div class="col-md-6 mb-3 mb-md-0">
              <label for="name" class="form-label">Full Name</label>
                  <div class="input-group input-group-lg">
                    <span class="input-group-text bg-light border-end-0"><i class="fas fa-user text-primary"></i></span>
                    <input type="text" class="form-control border-start-0" id="name" name="name" required>
              </div>
            </div>
            <div class="col-md-6">
              <label for="email" class="form-label">Email address</label>
                  <div class="input-group input-group-lg">
                    <span class="input-group-text bg-light border-end-0"><i class="fas fa-envelope text-primary"></i></span>
                    <input type="email" class="form-control border-start-0" id="email" name="email" placeholder="name@utem.edu.my" required>
              </div>
              <small class="form-text text-muted">Use your UTeM email address</small>
            </div>
          </div>
          
              <div class="row mb-4">
            <div class="col-md-6 mb-3 mb-md-0">
              <label for="password" class="form-label">Password</label>
                  <div class="input-group input-group-lg">
                    <span class="input-group-text bg-light border-end-0"><i class="fas fa-lock text-primary"></i></span>
                    <input type="password" class="form-control border-start-0" id="password" name="password" required>
                    <button class="btn btn-outline-secondary border-start-0" type="button" id="togglePassword">
                      <i class="fas fa-eye"></i>
                    </button>
              </div>
            </div>
            <div class="col-md-6">
              <label for="confirmPassword" class="form-label">Confirm Password</label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-light border-end-0"><i class="fas fa-lock text-primary"></i></span>
                <input type="password" class="form-control border-start-0" id="confirmPassword" name="confirmPassword" required>
                <button class="btn btn-outline-secondary border-start-0" type="button" id="toggleConfirmPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
          </div>
          
              <!-- Driver fields -->
              <div id="driverFields" class="mb-4" style="display: none;">
                <div class="card border-0 bg-light shadow-sm">
                  <div class="card-body p-4">
                    <h5 class="card-title mb-4"><i class="fas fa-info-circle me-2"></i> Driver Information</h5>
                <div class="row mb-3">
                  <div class="col-md-6 mb-3 mb-md-0">
                    <label for="carModel" class="form-label">Car Model</label>
                        <div class="input-group">
                          <span class="input-group-text bg-white"><i class="fas fa-car-side"></i></span>
                          <input type="text" class="form-control" id="carModel" name="carModel" placeholder="e.g. Toyota Vios">
                        </div>
                  </div>
                  <div class="col-md-6">
                    <label for="licensePlate" class="form-label">License Plate</label>
                        <div class="input-group">
                          <span class="input-group-text bg-white"><i class="fas fa-id-card"></i></span>
                          <input type="text" class="form-control" id="licensePlate" name="carPlateNumber" placeholder="e.g. ABC 1234">
                        </div>
                      </div>
                    </div>
                    <div class="mb-0">
                      <label for="driverLicense" class="form-label">Driver's License Number</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-address-card"></i></span>
                        <input type="text" class="form-control" id="driverLicense" name="license_number" placeholder="Enter your driver's license number">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Additional fields -->
              <div class="mb-4">
                <div class="card border-0 bg-light shadow-sm">
                  <div class="card-body p-4">
                    <h5 class="card-title mb-4"><i class="fas fa-user-circle me-2"></i> Additional Information</h5>
                    <div class="mb-3">
                      <label for="phoneNumber" class="form-label">Phone Number</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-phone"></i></span>
                        <input type="tel" class="form-control" id="phoneNumber" name="phone" placeholder="e.g. +60 12-345 6789" required>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="studentId" class="form-label">Student ID</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-id-badge"></i></span>
                        <input type="text" class="form-control" id="studentId" name="studentId" placeholder="Enter your UTeM student ID" required>
                      </div>
                    </div>
                    <div class="mb-0">
                      <label for="faculty" class="form-label">Faculty</label>
                      <div class="input-group">
                        <span class="input-group-text bg-white"><i class="fas fa-university"></i></span>
                        <select class="form-select" id="faculty" name="faculty" required>
                          <option value="" selected disabled>Select your faculty</option>
                          <option value="FKEKK">Faculty of Electronic and Computer Engineering</option>
                          <option value="FKE">Faculty of Electrical Engineering</option>
                          <option value="FKM">Faculty of Mechanical Engineering</option>
                          <option value="FTKMP">Faculty of Manufacturing Engineering</option>
                          <option value="FTMK">Faculty of Information and Communication Technology</option>
                          <option value="FKP">Faculty of Engineering Technology</option>
                          <option value="FPTT">Faculty of Technology Management and Technopreneurship</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Terms and agreement -->
              <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="termsCheck" name="termsCheck" required>
                <label class="form-check-label" for="termsCheck">
                  I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and <a href="#" class="text-decoration-none">Privacy Policy</a>
                </label>
              </div>
              
              <!-- Hidden fields for timestamps and ratings -->
              <input type="hidden" name="joined_at" id="joined_at">
              <input type="hidden" name="updated_at" id="updated_at">
              <input type="hidden" name="rating_count" value="0">
              <input type="hidden" name="average_rating" value="0">
              <input type="hidden" name="status" id="status" value="">
              
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary btn-lg px-4">
                  Create Account <i class="fas fa-user-plus ms-2"></i>
                </button>
              </div>
            </div>
          </form>
        
        <div class="mt-4 text-center">
            <p>Already have an account? <a href="/auth/login" class="text-decoration-none fw-bold">Login here</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Form elements
    const registerForm = document.getElementById('registerForm');
    const roleSelect = document.getElementById('roleSelect');
    const driverFields = document.getElementById('driverFields');
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirmPassword');
    const joinedAtField = document.getElementById('joined_at');
    const updatedAtField = document.getElementById('updated_at');
    const statusField = document.getElementById('status');
    
    // Set timestamps
    joinedAtField.value = new Date().toISOString();
    updatedAtField.value = new Date().toISOString();
    
    // Toggle password visibility
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    
    togglePassword.addEventListener('click', function() {
      const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordField.setAttribute('type', type);
      this.querySelector('i').classList.toggle('fa-eye');
      this.querySelector('i').classList.toggle('fa-eye-slash');
    });
    
    toggleConfirmPassword.addEventListener('click', function() {
      const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
      confirmPasswordField.setAttribute('type', type);
      this.querySelector('i').classList.toggle('fa-eye');
      this.querySelector('i').classList.toggle('fa-eye-slash');
    });
    
    // Toggle driver fields based on role selection
    roleSelect.addEventListener('change', function() {
      if (this.value === 'driver') {
        driverFields.style.display = 'block';
        statusField.value = 'available';
      } else {
        driverFields.style.display = 'none';
        statusField.value = '';
      }
    });
    
    // Initial driver fields visibility
    if (roleSelect.value === 'driver') {
      driverFields.style.display = 'block';
      statusField.value = 'available';
    }
    
    // Form validation
    registerForm.addEventListener('submit', function(e) {
      // Validate passwords match
      if (passwordField.value !== confirmPasswordField.value) {
        e.preventDefault();
        alert('Passwords do not match');
        return;
      }
      
      // Validate driver fields if driver role is selected
      if (roleSelect.value === 'driver') {
        const carModel = document.getElementById('carModel');
        const licensePlate = document.getElementById('licensePlate');
        const driverLicense = document.getElementById('driverLicense');
        
        if (!carModel.value.trim() || !licensePlate.value.trim() || !driverLicense.value.trim()) {
          e.preventDefault();
          alert('Please fill in all driver information fields');
          return;
        }
      }
      
      // Check if terms are accepted
      const termsCheck = document.getElementById('termsCheck');
      if (!termsCheck.checked) {
        e.preventDefault();
        alert('Please accept the Terms of Service and Privacy Policy');
        return;
      }
      
      console.log('Form submission proceeding with role:', roleSelect.value);
    });
  });
</script>

<style>
  .app-icon {
    width: 70px;
    height: 70px;
    background-color: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    font-size: 2rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  }
  
  /* Progress steps */
  .registration-progress .step {
    font-size: 0.9rem;
    color: var(--gray);
    position: relative;
    transition: var(--transition);
  }
  
  .registration-progress .step.active {
    color: var(--primary);
    font-weight: 600;
  }
  
  .registration-progress .progress-bar {
    background-color: var(--primary);
    transition: width 0.3s ease;
  }
  
  /* Role selection */
  .role-selection-container {
    background-color: rgba(255, 107, 53, 0.05);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    border: 1px solid rgba(255, 107, 53, 0.1);
    margin-bottom: 1.5rem;
    position: relative;
  }
  
  .role-selection-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(to right, var(--primary), var(--primary-dark));
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  }
  
  /* Form validation */
  .is-invalid {
    border-color: var(--danger) !important;
  }
  
  .invalid-feedback {
    display: block;
    margin-top: 0.25rem;
  }
</style> 